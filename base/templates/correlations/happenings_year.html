{% extends "layouts/site_base.html" %}
{% load correlation_tags static %}

{% block title %}{{ year|date:"Y" }} Happenings{% endblock %}
{% block body-class %}override{% endblock %}
{% block content %}
<section class="happenings happening-decade-{{ year|date:'Y'|slice:':3' }}0">
  <header class="override-header">
    <div class="container">
      <h1 class="happening-header"><span class="year">{{ year|date:"Y" }}</span> Happenings</h1>
    </div>

    <div class="happening-navigation">
      <div class="container">
        <div class="previous-year">
        {% if previous_year %}
          <a href="{% url 'happenings-by-year' previous_year|date:'Y' %}"><span class="ss-icon ss-navigateleft"></span> {{ previous_year|date:"Y" }}</a>
        {% endif %}
        </div>
        <div class="happening-decades">
          <header class="happening-decades-header">
            <a href="javascript:;" class="happening-toggle">
              <span class="ss-icon ss-calendar"></span>
              <strong>Other Years</strong>
              <span class="ss-icon ss-dropdown"></span>
            </a>
          </header>
          <ul class="happening-decade-list">
          {% for decade, values in years.items reversed %}
            <li class="{{ decade }}">
              <strong>{{ decade }}</strong>
              <ul class="happening-year-list">
              {% for value in values %}
                <li {% if year == value %}class="selected"{% endif %}>
                  <a href="{% url 'happenings-by-year' value|date:'Y' %}">{{ value|date:"Y" }}</a>
                </li>
              {% endfor %}
              </ul>
            </li>
          {% endfor %}
          </ul>
        </div>
        <div class="next-year">
        {% if next_year %}
          <a href="{% url 'happenings-by-year' next_year|date:'Y' %}">{{ next_year|date:"Y" }} <span class="ss-icon ss-navigateright"></span></a>
        {% endif %}
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    {% comment %}
    <ul class="happening-month-list">
    {% for date in date_list %}
      <li><a href="#{{ date|date:"F"|lower }}">{{ date|date:"F" }}</a></li>
    {% endfor %}
    </ul>
    {% endcomment %}

    {% regroup object_list by timestamp.month as month_list %}
    <ul class="happening-month-list">
    {% for month in month_list reversed %}
      <li class="happening-month" id="{{ month.grouper|month_name|lower }}">
        <h2>{{ month.grouper|month_name }}</h2>
        <ul class="happening-date-list">
        {% for item in month.list reversed %}
          <li class="happening-date">
            <div class="happening-timestamp">
            {% ifchanged %}
              <div class="timestamp-box">
                <span class="timestamp-date">{{ item.timestamp|date:"j" }}</span>
                <span class="timestamp-day">{{ item.timestamp|date:"D" }}</span>
              </div>
            {% endifchanged %}
            </div>
            <div class="happening-event">
            {% with item.content_object as object %}
              <a href="{{ object.get_absolute_url }}">
                <span class="romanized-name">{{ object }}</span>
                <span class="name">{{ object.name }}</span>
              </a>
              {% if object.image %}<img src="{% get_media_prefix %}{{ object.image }}">{% endif %}
              {% if item.date_field == "birthdate" %}({{ object.age }}){% endif %}
              {% if item.date_field == "released" %}{{ object.participants }}{% endif %}
            {% endwith %}
            </div>
            <div class="happening-verb">
              <span class="pill">{{ item.identifier }}</span>
              <span class="pill">{{ item.date_field }}</span>
            </div>
          </li>
        {% endfor %}
        </ul>
      </li>
    {% endfor %}
    </ul>
  </div>
</section>
{% endblock content %}
