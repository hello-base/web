{% load static %}

{% for item in month.list %}
<li class="happening-date {% ifchanged item.timestamp %}new-day{% endifchanged %}">
{% with item.content_object as object %}
  <div class="happening-timestamp">
  {% ifchanged %}
    <div class="timestamp-box">
      <span class="timestamp-date">{{ item.timestamp|date:"j" }}</span>
      {# <span class="timestamp-day">{{ item.timestamp|date:"D" }}</span> #}
    </div>
  {% endifchanged %}
  </div>

  {# merchandise.music #}
  {% if item.identifier == "album" %}
  <div class="happening-event">
    {% for participant in object.participants %}<a href="{{ participant.get_absolute_url }}">{{ participant }}</a>{% include "utilities/commaify.html" %}{% endfor %} releases <a href="{{ object.get_absolute_url }}">{{ object }}</a>
  </div>
  <div class="happening-illustration">
    {% for participant in object.participants %}<img src="{% get_media_prefix %}{{ participant.image }}">{% endfor %}
    <div class="happening-action"><span class="ss-icon ss-vinylrecord"></span></div>
    <img src="{% get_media_prefix %}{{ object.art_square }}">
  </div>
  {% endif %}

  {% if item.identifier == "single" %}
  <div class="happening-event">
    {% for participant in object.participants %}<a href="{{ participant.get_absolute_url }}">{{ participant }}</a>{% include "utilities/commaify.html" %}{% endfor %} releases <a href="{{ object.get_absolute_url }}">{{ object }}</a>
  </div>
  <div class="happening-illustration">
    {% for participant in object.participants %}<img src="{% get_media_prefix %}{{ participant.image }}">{% endfor %}
    <div class="happening-action"><span class="ss-icon ss-disc"></span></div>
    <img src="{% get_media_prefix %}{{ object.art_square }}">
  </div>
  {% endif %}

  {# people.group #}
  {% if item.identifier == "group" %}
    {% if item.date_field == "started" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> is formed
      Original members: {% for member in object.memberships.all reversed %}{% if member.started == object.started %}{{ member.idol }}{% include "utilities/commaify.html" %}{% endif %}{% endfor %}
    </div>
    <div class="happening-illustration">
      {% for participant in object.members.all %}<img src="{% get_media_prefix %}{{ participant.image }}">{% endfor %}
      <div class="happening-action"><span class="ss-icon ss-scaledown"></span></div>
      <img src="{% get_media_prefix %}{{ object.image }}">
    </div>
    {% endif %}
    {% if item.date_field == "ended" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> disbands
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.image }}">
      <div class="happening-action"><span class="ss-icon ss-scaleup"></span></div>
    </div>
    {% endif %}
  {% endif %}

  {# people.idol #}
  {% if item.identifier == "idol" %}
    {% if item.date_field == "birthdate" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> is born
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.image }}">
    </div>
    {% endif %}
    {% if item.date_field == "started" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> joins Hello! Project
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.image }}">
      <div class="happening-action"><span class="ss-icon ss-download"></span></div>
      <div class="happening-subject hp-subject"><span>H!P<strong>'98</strong></span></div>
    </div>
    {% endif %}
    {% if item.date_field == "graduated" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> leaves Hello! Project
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.image }}">
      <div class="happening-action"><span class="ss-icon ss-upload"></span></div>
      <div class="happening-subject hp-subject"><span>H!P<strong>'98</strong></span></div>
    </div>
    {% endif %}
    {% if item.date_field == "retired" %}
    <div class="happening-event">
      <a href="{{ object.get_absolute_url }}">{{ object }}</a> retires from show business
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.image }}">
      <div class="happening-action"><span class="ss-icon ss-right"></span></div>
      <div class="happening-subject icon-subject">
        <span class="ss-icon ss-luggage"></span>
      </div>
    </div>
    {% endif %}
  {% endif %}

  {# people.membership #}
  {% if item.identifier == "membership" %}
    {% if item.date_field == "started" %}
      {% if object.group.romanized_name == "Soloist" %}
      <div class="happening-event">
        <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> becomes a soloist
      </div>
      <div class="happening-illustration">
        <img src="{% get_media_prefix %}{{ object.idol.image }}">
        <div class="happening-action"><span class="ss-icon ss-mic"></span></div>
      </div>
      {% else %}
      <div class="happening-event">
        <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> joins <a href="{{ object.group.get_absolute_url }}">{{ object.group }}</a>
      </div>
      <div class="happening-illustration">
        <img src="{% get_media_prefix %}{{ object.idol.image }}">
        <div class="happening-action"><span class="ss-icon ss-download"></span></div>
        <img src="{% get_media_prefix %}{{ object.group.image }}">
      </div>
      {% endif %}
    {% endif %}
    {% if item.date_field == "ended" %}
      {% if object.group.romanized_name == "Soloist" %}
      <div class="happening-event">
        <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> stops being a soloist
      </div>
      <div class="happening-illustration">
        <div class="happening-actor"><img src="{% get_media_prefix %}{{ object.idol.image }}"></div>
        <div class="happening-action"><span class="ss-icon ss-ban"></span></div>
        <div class="happening-subject icon-subject">
          <span class="ss-icon ss-mic"></span>
        </div>
      </div>
      {% else %}
      <div class="happening-event">
        <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> leaves <a href="{{ object.group.get_absolute_url }}">{{ object.group }}</a>
      </div>
      <div class="happening-illustration">
        <img src="{% get_media_prefix %}{{ object.idol.image }}">
        <div class="happening-action"><span class="ss-icon ss-upload"></span></div>
        <img src="{% get_media_prefix %}{{ object.group.image }}">
      </div>
      {% endif %}
    {% endif %}
    {% if item.date_field == "leadership_started" %}
    <div class="happening-event">
      <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> becomes leader of <a href="{{ object.group.get_absolute_url }}">{{ object.group }}</a>
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.idol.image }}">
      <div class="happening-action"><span class="ss-icon ss-download"></span></div>
      <img src="{% get_media_prefix %}{{ object.group.image }}">
    </div>
    {% endif %}
    {% if item.date_field == "leadership_ended" %}
    <div class="happening-event">
      <a href="{{ object.idol.get_absolute_url }}">{{ object.idol }}</a> steps down as leader of <a href="{{ object.group.get_absolute_url }}">{{ object.group }}</a>
    </div>
    <div class="happening-illustration">
      <img src="{% get_media_prefix %}{{ object.idol.image }}">
      <div class="happening-action"><span class="ss-icon ss-upload"></span></div>
      <img src="{% get_media_prefix %}{{ object.group.image }}">
    </div>
    {% endif %}
  {% endif %}

{% endwith %}
</li>
{% endfor %}
