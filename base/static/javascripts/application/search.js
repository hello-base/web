// Generated by CoffeeScript 1.8.0
(function() {
  var Results,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $(document).on('focusin', '.js-search', function() {
    new Results(this);
  });

  Results = (function() {
    function Results(field) {
      this.onFieldInput = __bind(this.onFieldInput, this);
      this.onFieldKeyDown = __bind(this.onFieldKeyDown, this);
      this.teardown = __bind(this.teardown, this);
      this.$field = $(field);
      this.$form = $(field.form);
      this.$field.on('keydown.results', this.onFieldKeyDown);
      this.$field.on('input.results', this.onFieldInput);
      this.$form.on('submit.results', this.teardown);
      this.$template = $('#js-search-results-template');
      this.$results = $('.js-search-results');
    }

    Results.prototype.teardown = function() {
      this.$field.off('.results');
      this.$form.off('.results');
      return this.$results.removeClass('active');
    };

    Results.prototype.onFieldKeyDown = function(event) {
      if (event.hotkey === 'esc') {
        return this.$results.removeClass('active');
      }
    };

    Results.prototype.onFieldInput = function() {
      this.$results.toggleClass('active', this.$field.val() !== '');
      return $.ajax({
        url: '/search/autocomplete/',
        data: {
          q: this.$field.val()
        },
        success: (function(_this) {
          return function(data) {
            var template;
            template = Handlebars.templates['autocomplete'];
            return _this.$results.html(template(data));
          };
        })(this)
      });
    };

    return Results;

  })();

  $(document).on('click', '.result-item', function() {
    $('#id_q').val('');
  });

}).call(this);
